<MudDialog>
    <DialogContent>
        <MudGrid>
            <MudItem xs="12" sm="6">
                <MudText Typo="Typo.subtitle2" Color="Color.Secondary">採購單號</MudText>
                <MudText Typo="Typo.body1">@Order.OrderNumber</MudText>
            </MudItem>
            <MudItem xs="12" sm="6">
                <MudText Typo="Typo.subtitle2" Color="Color.Secondary">供應商</MudText>
                <MudText Typo="Typo.body1">@Order.Supplier.Name</MudText>
            </MudItem>
            <MudItem xs="12" sm="6">
                <MudText Typo="Typo.subtitle2" Color="Color.Secondary">目標倉庫</MudText>
                <MudText Typo="Typo.body1">@Order.Warehouse.Name</MudText>
            </MudItem>
            <MudItem xs="12" sm="6">
                <MudText Typo="Typo.subtitle2" Color="Color.Secondary">預計交貨日</MudText>
                <MudText Typo="Typo.body1">@Order.ExpectedDeliveryDate.ToString("yyyy/MM/dd")</MudText>
            </MudItem>
            <MudItem xs="12" sm="6">
                <MudText Typo="Typo.subtitle2" Color="Color.Secondary">狀態</MudText>
                <MudChip Size="Size.Small" Color="@GetStatusColor(Order.Status)">@GetStatusText(Order.Status)</MudChip>
            </MudItem>
            <MudItem xs="12" sm="6">
                <MudText Typo="Typo.subtitle2" Color="Color.Secondary">建立時間</MudText>
                <MudText Typo="Typo.body1">@Order.CreatedAt.ToLocalTime().ToString("yyyy/MM/dd HH:mm")</MudText>
            </MudItem>
        </MudGrid>

        <MudDivider Class="my-4" />

        <MudText Typo="Typo.h6" Class="mb-2">商品明細</MudText>
        <MudSimpleTable Dense="true">
            <thead>
                <tr>
                    <th>商品</th>
                    <th>數量</th>
                    <th>已收貨</th>
                    <th>單價</th>
                    <th>小計</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Order.Items)
                {
                    <tr>
                        <td>@item.Product?.Name</td>
                        <td>@item.Quantity</td>
                        <td>@item.ReceivedQuantity</td>
                        <td>@item.UnitPrice.ToString("C0")</td>
                        <td>@item.SubTotal.ToString("C0")</td>
                    </tr>
                }
            </tbody>
        </MudSimpleTable>

        <MudText Typo="Typo.h6" Class="mt-4" Align="Align.Right" Color="Color.Primary">
            總計: @Order.TotalAmount.ToString("C0")
        </MudText>

        @if (!string.IsNullOrWhiteSpace(Order.Notes))
        {
            <MudDivider Class="my-4" />
            <MudText Typo="Typo.subtitle2" Color="Color.Secondary">備註</MudText>
            <MudText Typo="Typo.body1">@Order.Notes</MudText>
        }
    </DialogContent>
    <DialogActions>
        <MudButton OnClick="Close">關閉</MudButton>
    </DialogActions>
</MudDialog>

@code {
    [CascadingParameter] private MudDialogInstance MudDialog { get; set; } = null!;
    [Parameter] public PurchaseOrder Order { get; set; } = null!;

    private void Close() => MudDialog.Close();

    private Color GetStatusColor(PurchaseOrderStatus status) => status switch
    {
        PurchaseOrderStatus.Draft => Color.Default,
        PurchaseOrderStatus.PendingApproval => Color.Warning,
        PurchaseOrderStatus.Approved => Color.Info,
        PurchaseOrderStatus.PartialReceived => Color.Primary,
        PurchaseOrderStatus.Completed => Color.Success,
        PurchaseOrderStatus.Cancelled => Color.Error,
        _ => Color.Default
    };

    private string GetStatusText(PurchaseOrderStatus status) => status switch
    {
        PurchaseOrderStatus.Draft => "草稿",
        PurchaseOrderStatus.PendingApproval => "待核准",
        PurchaseOrderStatus.Approved => "已核准",
        PurchaseOrderStatus.PartialReceived => "部分收貨",
        PurchaseOrderStatus.Completed => "已完成",
        PurchaseOrderStatus.Cancelled => "已取消",
        _ => status.ToString()
    };
}
